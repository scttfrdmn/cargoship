---
gitlab_urls:
  api: https://gitlab.oit.duke.edu/api/v4/
  download: https://gitlab.oit.duke.edu
builds:
  - env:
      - CGO_ENABLED=0
    main: ./cli
    mod_timestamp: '{{ .CommitTimestamp }}'
    flags:
      - -trimpath
    ldflags: |
      -s -w
      -X {{ .ModulePath }}/cli/cmd.date={{ .CommitTimestamp }}
      -X {{ .ModulePath }}/cli/cmd.version={{ .Tag }}
      -X {{ .ModulePath }}/cli/cmd.commit={{ .ShortCommit }}
    goos:
      - linux
    goarch:
      - amd64
    binary: 'suitcasectl'
archives:
  - format: tar.gz
    name_template: '{{ .ProjectName }}-{{ .Version }}_{{ .Os }}_{{ .Arch }}'
checksum:
  name_template: '{{ .ProjectName }}-{{ .Version }}_SHA256SUMS'
  algorithm: sha256
snapshot:
  name_template: "{{ .Tag }}-snapshot"

nfpms:
  - id: rpms
    license: MIT
    description: Package up research files for distribution
    vendor: Duke University
    section: admin
    priority: optional
    maintainer: Drew Stinnett <drew.stinnett@duke.edu>
    homepage: >
      {{ if index .Env "CI_PROJECT_URL" }}{{ . }}{{ else }}https://gitlab.oit.duke.edu/oit-ssi-systems{{ end }}
    formats:
      - rpm
  - id: debs
    license: MIT
    description: Package up research files for distribution
    vendor: Duke University
    section: admin
    priority: optional
    homepage: >
      {{ if index .Env "CI_PROJECT_URL" }}{{ . }}{{ else }}https://gitlab.oit.duke.edu/oit-ssi-systems{{ end }}
    maintainer: Drew Stinnett <drew.stinnett@duke.edu>
    formats:
      - deb